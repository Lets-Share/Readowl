<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Readowl Digital Library</title>
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* --- Custom styles to match the Soft Cream/Neomorphic app theme --- */
        :root {
            /* Soft background and main content colors from the image */
            --bg-soft: #fdfcfb; 
            --card-light: #ffffff;
            --accent-soft: #f0e0c9; /* Soft tan/gold for selection state */
            --primary-action: #14b8a6; /* Teal for high-contrast actions (Download/Action) */
            --text-dark: #1f2937; /* Dark charcoal */
            --text-medium: #5b5b5b; /* Medium grey for body text */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-soft); 
            color: var(--text-dark);
            display: flex;
            min-height: 100vh;
            overflow: hidden; 
        }

        /* Sidebar Styling */
        #sidebar {
            width: 250px; 
            flex-shrink: 0;
            background-color: var(--card-light);
            box-shadow: 4px 0 10px rgba(0, 0, 0, 0.03);
            border-right: 1px solid #f0f0f0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        /* Main Library Area */
        #main-library {
            flex-grow: 1;
            padding: 2rem;
            overflow-y: auto; 
            max-height: 100vh;
        }
        
        /* Navigation Links and Selected State */
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem; 
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .nav-item:hover {
            background-color: #f7f7f7;
        }
        .nav-item.active {
            background-color: var(--accent-soft); 
            color: var(--text-dark);
            font-weight: 600;
        }
        .nav-item.active svg {
            color: var(--text-dark);
        }

        /* Content Wrapper (The 'screen' area in the image) */
        .content-wrapper {
            background-color: var(--card-light);
            border-radius: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            padding: 2rem 3rem;
            min-height: 85vh; /* Ensure wrapper fills space */
        }

        /* Shelf Styling (The horizontal line effect) */
        .book-shelf {
            position: relative;
            padding-bottom: 2.5rem; 
            margin-bottom: 3rem;
            padding-top: 0.5rem;
        }
        .book-shelf::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px; 
            background: linear-gradient(to right, #e0d9cd, #f8f6f4, #e0d9cd); 
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); 
        }
        
        /* Book Card Styling (Minimalist) */
        .book-card img {
            width: 100%;
            height: auto;
            border-radius: 0.5rem; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }
        .book-card:hover img {
            transform: translateY(-4px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }
        .book-card-title {
            font-size: 0.75rem;
            line-height: 1.1;
            height: 2.2em; 
            overflow: hidden;
            -webkit-box-orient: vertical;
            margin-bottom: 0.5rem;
        }
        
        /* Action Button (Teal accent for Download) */
        .action-btn {
            background-color: var(--primary-action);
            transition: all 0.3s ease;
        }
        .action-btn:hover {
            background-color: #0d9488;
        }

        /* --- Manual Horizontal Scrolling Container --- */
        .book-shelf-container {
            display: flex;
            overflow-x: auto; /* Enable manual horizontal scrolling */
            padding-bottom: 10px; /* Space for scroll bar on some systems */
            /* Hide scrollbar for a cleaner look while keeping functionality */
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        .book-shelf-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* Fixed width for scroll consistency */
        .book-card-item {
            flex-shrink: 0;
            width: 110px; 
            margin-right: 24px; /* gap-6 equivalent */
            text-align: center;
        }

        /* Mobile Adjustments */
        @media (max-width: 1024px) {
            #sidebar { display: none; }
            body { flex-direction: column; overflow-y: auto; }
            #main-library { padding: 1rem; }
            .content-wrapper { padding: 1.5rem; border-radius: 1.5rem; }
        }
    </style>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, query, orderBy, limit, serverTimestamp, getDocs, where } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Setup Firebase and global variables
        setLogLevel('Debug');
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app;
        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        let currentPage = 'home'; // Default page is 'home'

        // Initialize Firebase
        if (Object.keys(firebaseConfig).length > 0) {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
        } else {
            console.error("Firebase configuration is missing.");
        }

        // Authentication State Listener
        if (auth) {
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    document.getElementById('profile-name').textContent = userId.substring(0, 8); // Show short UID
                    document.getElementById('profile-full-uid').textContent = userId; // Show full UID on hover
                    document.getElementById('auth-button-container').classList.add('hidden');
                    document.getElementById('profile-card').classList.remove('hidden');
                } else {
                    userId = null;
                    document.getElementById('auth-button-container').classList.remove('hidden');
                    document.getElementById('profile-card').classList.add('hidden');
                }
                isAuthReady = true;
                // Re-render current page to reflect auth status change (e.g., if needed for dynamic content)
                renderPageContent(currentPage);
            });

            // Initial sign-in attempt
            (async () => {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                } catch (error) {
                    console.error("Firebase sign-in failed:", error);
                    showNotification(`Authentication failed: ${error.message}`, 'error');
                }
            })();
        }

        // --- Auth Modal Handlers (omitted for brevity) ---

        window.openAuthModal = (mode) => {
            document.getElementById('auth-mode').textContent = mode === 'login' ? 'Log In' : 'Sign Up';
            document.getElementById('auth-submit-btn').textContent = mode === 'login' ? 'Log In' : 'Sign Up';
            document.getElementById('auth-switch-link').textContent = mode === 'login' ? 'Need an account? Sign Up' : 'Already have an account? Log In';
            document.getElementById('auth-switch-link').onclick = () => window.openAuthModal(mode === 'login' ? 'signup' : 'login');
            document.getElementById('auth-submit-btn').dataset.mode = mode;
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('auth-modal-overlay').classList.remove('hidden');
        }

        window.closeAuthModal = () => {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-modal-overlay').classList.add('hidden');
        }

        window.handleAuthSubmit = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            const mode = document.getElementById('auth-submit-btn').dataset.mode;

            if (!email || !password) {
                showNotification("Please enter both email and password.", 'warning');
                return;
            }

            try {
                if (mode === 'signup') {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showNotification("Sign Up successful! You are now logged in.", 'success');
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                    showNotification("Log In successful!", 'success');
                }
                window.closeAuthModal();
            } catch (error) {
                console.error("Auth error:", error);
                showNotification(`Authentication Failed: ${error.message.replace('Firebase: ', '')}`, 'error');
            }
        }
        
        window.handleLogout = async () => {
             if (auth) {
                try {
                    await signOut(auth);
                    showNotification("Logged out successfully.", 'success');
                } catch (error) {
                    console.error("Logout error:", error);
                    showNotification(`Logout failed: ${error.message}`, 'error');
                }
            }
        }

        // --- Book Data ---

        const books = [
            // Programming Shelf 
            { id: 1, title: "9th New Math Book", author: "Parho.pk", coverUrl: "https://i.ibb.co/h7gY4J6/download-1.jpg", downloadLink: "https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf", category: 'programming' },
            { id: 2, title: "The Art of Clear JavaScript", author: "Jane Doe", coverUrl: "https://placehold.co/400x600/facc15/1f2937?text=JavaScript", downloadLink: "#", category: 'programming' },
            { id: 3, title: "Deep Learning with Python", author: "Cal Newport", coverUrl: "https://placehold.co/400x600/06b6d4/ffffff?text=Python+DL", downloadLink: "#", category: 'programming' },
            { id: 4, title: "UX Strategy Fundamentals", author: "R. A. Smith", coverUrl: "https://placehold.co/400x600/3d3d3d/ffffff?text=UX+Design", downloadLink: "#", category: 'programming' },
            { id: 5, title: "C# Design Patterns", author: "M. K. Patel", coverUrl: "https://placehold.co/400x600/ef4444/ffffff?text=C%23+Patterns", downloadLink: "#", category: 'programming' },
            
            // Fiction Shelf
            { id: 6, title: "Lord of the Rings: Fellowship", author: "J.R.R. Tolkien", coverUrl: "https://placehold.co/400x600/6b7280/ffffff?text=Fantasy", downloadLink: "#", category: 'fiction' },
            { id: 7, title: "1984 by George Orwell", author: "George Orwell", coverUrl: "https://placehold.co/400x600/ef4444/ffffff?text=Dystopian", downloadLink: "#", category: 'fiction' },
            { id: 8, title: "Dune", author: "Frank Herbert", coverUrl: "https://placehold.co/400x600/22c55e/ffffff?text=Sci-Fi", downloadLink: "#", category: 'fiction' },
            { id: 9, title: "The Martian", author: "Andy Weir", coverUrl: "https://placehold.co/400x600/f97316/ffffff?text=Sci-Fi", downloadLink: "#", category: 'fiction' },
            { id: 10, title: "Pride and Prejudice", author: "Jane Austen", coverUrl: "https://placehold.co/400x600/0284c7/ffffff?text=Classic", downloadLink: "#", category: 'fiction' },

            // History Shelf
            { id: 11, title: "Brief History of Time", author: "S. Hawking", coverUrl: "https://placehold.co/400x600/1f2937/ffffff?text=History", downloadLink: "#", category: 'history' },
            { id: 12, title: "Sapiens: A Brief History", author: "Yuval Noah Harari", coverUrl: "https://placehold.co/400x600/0284c7/ffffff?text=History", downloadLink: "#", category: 'history' },
            { id: 13, title: "World War II Atlas", author: "D. Airey", coverUrl: "https://placehold.co/400x600/94a3b8/ffffff?text=War+History", downloadLink: "#", category: 'history' },
            { id: 14, title: "The Age of Exploration", author: "M. Manson", coverUrl: "https://placehold.co/400x600/1f2937/ffffff?text=Exploration", downloadLink: "#", category: 'history' },
            { id: 15, title: "The Ottoman Empire", author: "W. McKinney", coverUrl: "https://placehold.co/400x600/0284c7/ffffff?text=Ottoman", downloadLink: "#", category: 'history' },
        ];
        
        // Groups books by their category
        const groupedBooks = books.reduce((acc, book) => {
            acc[book.category] = acc[book.category] || [];
            acc[book.category].push(book);
            return acc;
        }, {});


        // --- Page Switching Logic ---

        window.changePage = (pageName) => {
            currentPage = pageName;
            // Clear search bar when changing pages
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                 searchInput.value = '';
            }
            updateSidebarActiveState(pageName);
            renderPageContent(pageName);
        }

        function updateSidebarActiveState(pageName) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageName) {
                    item.classList.add('active');
                }
            });
        }


        // --- Shared Rendering Components ---

        // Helper function to handle download/action
        window.downloadBook = (title, url) => {
            if (url === '#') {
                showNotification(`Download link for "${title}" is a placeholder.`, 'warning');
                return;
            }
            window.open(url, '_blank');
            showNotification(`Starting download for "${title}"...`, 'success');
        }

        // Helper function to render a single book card
        function renderBookCard(book, actionText = 'Download PDF', actionFunc = 'downloadBook') {
            return `
                <div class="book-card-item">
                    <img src="${book.coverUrl}" alt="${book.title} Cover"
                         class="w-full h-auto object-cover rounded-lg"
                         onerror="this.onerror=null;this.src='https://placehold.co/400x600/e0d9cd/5b5b5b?text=Book';"
                    >
                    
                    <p class="book-card-title text-text-medium mt-2 leading-tight">
                        ${book.title}
                    </p>

                    <!-- Action Button -->
                    <button
                        onclick="${actionFunc}('${book.title.replace(/'/g, "\\'")}', '${book.downloadLink}')"
                        class="action-btn w-full mt-1 py-1 px-1 text-white text-[10px] font-semibold rounded-md tracking-wider"
                    >
                        ${actionText}
                    </button>
                </div>
            `;
        }
        
        // Helper function to render a shelf section with manual horizontal scrolling
        function renderShelf(title, booksArray, actionText = 'Full shelf') {
            if (booksArray.length === 0) return '';
            const shelfContent = booksArray.map(book => renderBookCard(book)).join('');
            
            return `
                <section class="book-shelf">
                    <!-- Shelf Header -->
                    <header class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-text-dark">${title}</h3>
                        <a href="#" class="text-xs text-primary-action hover:underline flex items-center" onclick="showNotification('Viewing ${actionText} for ${title}', 'warning')">
                            ${actionText}
                            <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i>
                        </a>
                    </header>
                    
                    <!-- Books on the Shelf (Manual Horizontal Scroll Container) -->
                    <div class="book-shelf-container">
                        ${shelfContent}
                    </div>
                </section>
            `;
        }


        // --- Content Rendering Functions for Each Page ---

        /**
         * Renders the My Library content (Shelves or Search Results).
         * @param {Array<Object>|null} searchResults - Filtered books array if search is active.
         * @param {string} currentQuery - The current search query string.
         */
        function renderLibraryContent(searchResults = null, currentQuery = '') {
            const container = document.getElementById('library-sections');
            let shelfSections = [];
            
            if (searchResults !== null) {
                // --- Search mode ---
                if (searchResults.length > 0) {
                     shelfSections.push(renderShelf(`Search Results for "${currentQuery}" (${searchResults.length})`, searchResults));
                } else {
                     shelfSections.push(`<div class="text-center py-10 text-gray-500 text-xl">No books found matching "${currentQuery}".</div>`);
                }

            } else {
                // --- Default Library mode ---
                shelfSections = [
                    renderShelf("Programming & Tech", groupedBooks.programming || []),
                    renderShelf("Fiction & Classics", groupedBooks.fiction || []),
                    renderShelf("History & Science", groupedBooks.history || [])
                ];
            }
            
            // Render the title and the dynamic shelves
            container.innerHTML = `<h1 class="text-3xl font-bold mb-8">My Library</h1>` + `<div class="space-y-12">${shelfSections.join('')}</div>`;
            lucide.createIcons(); 
        }

        /**
         * Handles the input event on the search bar, filtering and re-rendering the shelves.
         */
        window.handleSearch = () => {
            const searchInput = document.getElementById('search-input');
            if (!searchInput) return; 
            
            const query = searchInput.value.trim().toLowerCase();
            
            if (query.length === 0) {
                // When search is cleared, revert to default library view
                renderLibraryContent(null); 
                return;
            }
            
            // Filter the global books array
            const filteredBooks = books.filter(book => {
                const titleMatch = book.title.toLowerCase().includes(query);
                const authorMatch = book.author.toLowerCase().includes(query);
                return titleMatch || authorMatch;
            });
            
            // Render the search results, passing the query so the shelf title is accurate
            renderLibraryContent(filteredBooks, query); 
        }

        function renderHomeContent() {
            const container = document.getElementById('library-sections');
            
            // Welcome Banner
            const welcomeBanner = `
                <div class="bg-primary-action text-white p-6 rounded-2xl mb-12 shadow-lg">
                    <div class="flex items-center">
                        <i data-lucide="sparkles" class="w-8 h-8 mr-4"></i>
                        <div>
                            <h2 class="text-2xl font-bold">Welcome back, Reader!</h2>
                            <p class="text-sm opacity-90 mt-1">Discover new titles or dive back into your favorites.</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Featured/Trending Shelf
            const trendingBooks = [books[10], books[1], books[6], books[8], books[3], books[7]]; // Mix of categories
            const trendingShelf = renderShelf("Trending Now", trendingBooks, "View all trends");

            // Recommended for You (Simulated)
            const recommendedBooks = [books[5], books[9], books[14], books[2], books[11]];
            const recommendedShelf = renderShelf("Recommended for You", recommendedBooks, "Customize recommendations");

            container.innerHTML = `
                <h1 class="text-3xl font-bold mb-8">Home</h1>
                ${welcomeBanner}
                ${trendingShelf}
                ${recommendedShelf}
            `;
            lucide.createIcons();
        }

        function renderShopContent() {
            const container = document.getElementById('library-sections');
            
            // Shop Header
            const shopHeader = `
                <h1 class="text-3xl font-bold mb-8">Book Shop</h1>
                <p class="text-lg text-text-medium mb-10">Browse our latest releases and bestselling collections.</p>
            `;
            
            // New Releases (using a new set of data just for the shop feel)
            const newReleases = [
                { id: 20, title: "The Silent Watcher", author: "Anya Sharma", coverUrl: "https://placehold.co/400x600/374151/ffffff?text=Mystery", downloadLink: "#", category: 'fiction' },
                { id: 21, title: "Quantum Computing Explained", author: "Dr. L. Chen", coverUrl: "https://placehold.co/400x600/059669/ffffff?text=Tech+Guide", downloadLink: "#", category: 'programming' },
                { id: 22, title: "Culinary History of Rome", author: "E. Rossi", coverUrl: "https://placehold.co/400x600/99f6e4/1f2937?text=Food+History", downloadLink: "#", category: 'history' },
                ...books.slice(0, 3) // Add a few from the existing list
            ];

            const releasesShelf = newReleases.map(book => renderBookCard(book, 'Buy Now', 'showBuyDetails')).join('');
            
            // Shop Categories Grid
            const categories = ['Fiction', 'Technology', 'Science', 'Biography', 'Self-Help', 'Children'];
            const categoryGrid = categories.map(cat => `
                <div onclick="showNotification('Navigating to ${cat} category', 'info')" class="flex items-center justify-center p-4 bg-gray-50 border border-gray-200 rounded-xl hover:bg-accent-soft transition cursor-pointer shadow-sm">
                    <i data-lucide="folder-open" class="w-6 h-6 mr-3 text-amber-600"></i>
                    <span class="font-medium">${cat}</span>
                </div>
            `).join('');


            container.innerHTML = `
                ${shopHeader}
                
                <h3 class="text-xl font-semibold mb-4">New Releases</h3>
                <div class="book-shelf-container mb-12">${releasesShelf}</div>

                <h3 class="text-xl font-semibold mb-4">Browse Categories</h3>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                    ${categoryGrid}
                </div>
            `;
            lucide.createIcons();
        }

        window.showBuyDetails = (title) => {
            showNotification(`Purchase flow started for "${title}".`, 'info');
        }

        function renderNewsContent() {
            const container = document.getElementById('library-sections');
            
            // Mock News Articles
            const newsArticles = [
                { title: "Gemini-2.5-Flash Writes Best-Seller: AI Author Sparks Debate", date: "Oct 25", source: "TechDigest", icon: "megaphone", link: "#" },
                { title: "Classic Literature Sees Resurgence in Digital Formats", date: "Oct 24", source: "Publishers Weekly", icon: "book-open", link: "#" },
                { title: "The Future of E-Readers: Color Screens and Flexible Displays", date: "Oct 23", source: "Gadget Central", icon: "layout-dashboard", link: "#" },
                { title: "Interview with Sci-Fi Author Frank Herbert (Archived)", date: "Oct 22", source: "History Vault", icon: "user", link: "#" },
            ];

            const articlesHTML = newsArticles.map(article => `
                <div onclick="showNotification('Opening article: ${article.title}', 'info')" class="flex items-start p-4 bg-white rounded-xl shadow-sm hover:shadow-md transition cursor-pointer border border-gray-100">
                    <i data-lucide="${article.icon}" class="w-6 h-6 mr-4 text-primary-action flex-shrink-0 mt-1"></i>
                    <div>
                        <h4 class="font-semibold text-text-dark">${article.title}</h4>
                        <p class="text-xs text-gray-500 mt-1">
                            <span class="mr-2">${article.source}</span>
                            <span class="text-gray-400">â€¢</span>
                            <span class="ml-2">${article.date}</span>
                        </p>
                    </div>
                </div>
            `).join('');


            container.innerHTML = `
                <h1 class="text-3xl font-bold mb-8">Reading News</h1>
                <p class="text-lg text-text-medium mb-10">Stay updated with the world of books and technology.</p>
                
                <div class="space-y-4">
                    ${articlesHTML}
                </div>
            `;
            lucide.createIcons();
        }

        /**
         * Main function to dynamically render the page content based on the current state.
         */
        window.renderPageContent = (pageName) => {
            const pageHeader = document.getElementById('page-header');
            
            // Clear dynamic content area
            document.getElementById('library-sections').innerHTML = ''; 
            
            // Show/Hide Page Header (Tabs and Search Bar)
            if (pageName === 'library') {
                 // Ensure search bar value is cleared when landing on the page fresh
                 const searchInput = document.getElementById('search-input');
                 if (searchInput) searchInput.value = '';
                 
                 pageHeader.classList.remove('hidden');
                 renderLibraryContent(); // Renders default library shelves
            } else {
                 pageHeader.classList.add('hidden');
                 // Render other pages (Home, Shop, News)
                 switch (pageName) {
                    case 'home':
                        renderHomeContent();
                        break;
                    case 'shop':
                        renderShopContent();
                        break;
                    case 'news':
                        renderNewsContent();
                        break;
                 }
            }

            lucide.createIcons();
        }
        
        // --- Utility Functions (Notification) ---

        /**
         * Custom notification function to display messages to the user.
         */
        window.showNotification = (message, type = 'success') => {
            const notification = document.getElementById('notification');
            notification.textContent = message;

            // Set color based on type
            notification.classList.remove('bg-yellow-600', 'bg-teal-600', 'bg-red-600', 'bg-blue-600');
            if (type === 'success') {
                notification.classList.add('bg-teal-600');
            } else if (type === 'warning') {
                notification.classList.add('bg-yellow-600');
            } else if (type === 'info') {
                 notification.classList.add('bg-blue-600');
            } else {
                notification.classList.add('bg-red-600');
            }

            // Show element
            notification.classList.remove('hidden', 'opacity-0', 'translate-y-full');
            notification.classList.add('opacity-100', 'translate-y-0');

            setTimeout(() => {
                // Start fade-out and move-down transition
                notification.classList.remove('opacity-100', 'translate-y-0');
                notification.classList.add('opacity-0', 'translate-y-full');
                // Hide element after transition completes
                setTimeout(() => notification.classList.add('hidden'), 500);
            }, 3000);
        }

        // Setup the initial rendering when the window loads
        window.onload = () => {
            lucide.createIcons(); 
            // The initial page is set to 'home', so we render it and update the sidebar state.
            updateSidebarActiveState('home');
            renderPageContent('home'); 
        };
    </script>
</head>
<body>
    <!-- 1. FIXED LEFT SIDEBAR -->
    <aside id="sidebar" class="p-6">
        
        <!-- Top Section: Logo and Navigation -->
        <div>
            <!-- Logo: Readowl -->
            <div class="flex items-center mb-10 pl-2">
                <i data-lucide="book-open-check" class="w-8 h-8 mr-2 text-amber-500"></i>
                <span class="text-xl font-extrabold text-text-dark">Readowl</span>
            </div>

            <!-- Navigation Links -->
            <nav>
                <ul class="space-y-2 text-text-medium text-sm">
                    <!-- Added data-page attributes for easier navigation control -->
                    <li><div class="nav-item active" data-page="home" onclick="changePage('home')"><i data-lucide="home" class="w-5 h-5 mr-3"></i><span>Home</span></div></li>
                    <li><div class="nav-item" data-page="library" onclick="changePage('library')"><i data-lucide="book-open-text" class="w-5 h-5 mr-3"></i><span>My library</span></div></li>
                    <li><div class="nav-item" data-page="shop" onclick="changePage('shop')"><i data-lucide="shopping-bag" class="w-5 h-5 mr-3"></i><span>Shop</span></div></li>
                    <li><div class="nav-item" data-page="news" onclick="changePage('news')"><i data-lucide="newspaper" class="w-5 h-5 mr-3"></i><span>News</span></div></li>
                </ul>
            </nav>
        </div>

        <!-- Bottom Section: Continue Reading and Profile/Auth -->
        <div class="pb-4">
            <!-- Continue Reading Card -->
            <div class="p-3 bg-accent-soft rounded-2xl mb-4 shadow-inner-lg">
                 <h4 class="text-sm font-semibold text-text-dark mb-2">Continue reading</h4>
                 <div class="flex items-center space-x-2">
                    <img src="https://placehold.co/400x600/14b8a6/ffffff?text=UX+Design" alt="Book Cover" class="w-8 h-12 object-cover rounded-md shadow-md"/>
                    <div>
                        <p class="text-xs font-medium text-text-dark leading-tight">UX Strategy...</p>
                        <p class="text-[10px] text-gray-600">Chapter 5 - 45% done</p>
                    </div>
                 </div>
            </div>

            <!-- Authentication State -->
            <!-- 1. Login/Sign Up Button (Visible if not logged in) -->
            <div id="auth-button-container" class="mt-4">
                 <button onclick="openAuthModal('login')" class="w-full action-btn py-2 text-white font-semibold rounded-xl text-sm transition">
                    Login / Sign Up
                 </button>
            </div>

            <!-- 2. User Profile Card (Visible if logged in) -->
            <div id="profile-card" class="flex items-center p-2 rounded-xl hover:bg-gray-50 transition cursor-pointer hidden group relative">
                <img src="https://placehold.co/40x40/f0e0c9/1f2937?text=U" alt="User Profile" class="w-10 h-10 rounded-full object-cover mr-3 border border-gray-200"/>
                <div>
                    <span class="text-sm font-medium block" id="profile-name">User ID</span>
                    <!-- Full UID tooltip/display -->
                    <p id="profile-full-uid" class="text-[10px] text-gray-500 truncate" title="User ID">User ID</p>
                </div>
                <button onclick="handleLogout()" class="ml-auto text-red-500 hover:text-red-700 p-1 rounded-full transition">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                </button>
            </div>
        </div>
    </aside>

    <!-- 2. MAIN LIBRARY VIEW (Scrollable) -->
    <main id="main-library">
        
        <!-- Central Content Wrapper (White Background) -->
        <div class="content-wrapper">

            <!-- STABLE PAGE HEADER: Tabs and Search Bar (Hidden by default, shown only on 'library' page) -->
            <header id="page-header" class="mb-10 hidden">
                <!-- Tabs -->
                <div class="flex space-x-4 border-b border-gray-100 mb-6 nav-tabs">
                    <button class="px-4 py-2 text-sm font-semibold border-b-2 border-primary-action text-primary-action">
                        Shelves
                    </button>
                    <button class="px-4 py-2 text-sm text-gray-500 hover:text-text-dark transition">
                        All Books
                    </button>
                </div>
                
                <!-- Search Bar -->
                <div class="search-bar flex items-center bg-gray-50 rounded-xl p-3 border border-gray-100 shadow-inner">
                    <i data-lucide="search" class="w-5 h-5 text-gray-400 mr-3"></i>
                    <!-- This input is now permanent, ensuring smooth typing and focus -->
                    <input type="text" placeholder="Search in My library (e.g., Python, Jane Doe)" id="search-input"
                           class="w-full bg-transparent focus:outline-none text-text-dark placeholder-gray-400 text-base"
                           oninput="handleSearch()">
                </div>
            </header>
            
            <!-- Dynamic Content Area -->
            <div id="library-sections" class="space-y-12">
                <!-- Page content (Home, Library, Shop, News) will be injected here by JavaScript -->
            </div>
            
        </div>

        <!-- 3. AUTH MODAL (Hidden by default) -->
        <div id="auth-modal-overlay" class="fixed inset-0 bg-black bg-opacity-30 backdrop-blur-sm z-40 hidden" onclick="closeAuthModal()"></div>
        <div id="auth-modal" class="fixed inset-0 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-300">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="auth-mode" class="text-2xl font-bold">Log In</h3>
                    <button onclick="closeAuthModal()" class="text-gray-400 hover:text-text-dark transition">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <form onsubmit="event.preventDefault(); handleAuthSubmit();">
                    <div class="mb-4">
                        <label for="auth-email" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="auth-email" placeholder="user@example.com"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-action focus:border-primary-action" required>
                    </div>
                    <div class="mb-6">
                        <label for="auth-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="auth-password" placeholder="Min 6 characters"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-primary-action focus:border-primary-action" required>
                    </div>
                    
                    <button type="submit" id="auth-submit-btn" data-mode="login" 
                            class="action-btn w-full py-2.5 text-white font-semibold rounded-xl text-lg transition">
                        Log In
                    </button>
                    
                    <div class="text-center mt-4">
                        <a href="#" id="auth-switch-link" onclick="openAuthModal('signup')" class="text-sm text-primary-action hover:underline">Need an account? Sign Up</a>
                    </div>
                </form>
            </div>
        </div>

        <!-- 4. Custom Notification/Message Box -->
        <div id="notification"
             class="fixed bottom-6 right-6 text-white px-6 py-3 rounded-xl shadow-2xl font-semibold transition-all duration-500 transform translate-y-full opacity-0 hidden z-50">
            Notification Message
        </div>

    </main>
    
</body>
</html>
